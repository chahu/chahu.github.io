"use strict";function init(t,e,o){let a,r;e.append("g").attr("id","routes"),console.log(t,e,o);const n="start_date"in o[0]?"start_date":"date",i="start_date"in o[0]?"end_date":"date";function c(t){const e=o.filter(e=>e.start_date<=t&&(e.end_date>=t||!e.end_date));avoid_collision.reset&&avoid_collision.reset(),update(e),$("#current_date").val(t),$("#current_count").text(`(${e.length})`)}o.forEach(t=>{(!a||t[i]>a)&&(a=t[i]),(!r||t[n]<r)&&(r=t[n])}),$("#current_date").attr("min",r),$("#current_date").attr("max",a),$("#current_date").change(()=>c($("#current_date").val())),c("2020-01-01")}function update(t){const e=d3.select("#routes").selectAll("circle.event").data(t,t=>t.id);e.enter().append("circle").attr("class","event").attr("opacity",1).attr("fill",t=>get_color(t.route_color)).attr("stroke",t=>contrast_color("white",get_color(t.route_color))).attr("stroke-width","2").attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",5).on("mouseover",t=>hover(t,avoid_collision(t))).on("mouseout",(t,e,o)=>{d3.select("#info_div").transition().delay(200).duration(100).style("opacity",0)}).on("click",t=>window.open("https://www.vertical-life.info/en/indoor/the-cliffs-at-lic/climbs/"+t.route_id,"_blank")).transition().duration(1e3).attr("r",5).attr("cx",t=>avoid_collision(t).x).attr("cy",t=>avoid_collision(t).y),e.transition().duration(1e3).attr("fill",t=>get_color(t.route_color)).attr("r",5).attr("cx",t=>avoid_collision(t).x).attr("cy",t=>avoid_collision(t).y),e.exit().transition().duration(1e3).attr("r",20).attr("opacity",0).remove()}$(document).ready(async()=>{const t=d3.select("#svg_container");load_svg(t).then(e=>{d3.csv("data/routes.csv").then(o=>{o.forEach((t,e)=>{const o=d3.select("#"+t.wall).node().getPointAtLength(t.offset);t.x=o.x,t.y=o.y,t.offset=parseFloat(t.offset),t.id=e}),init(t,e,o)})})});
