"use strict";function init(t,e,o){e.append("g").attr("id","routes");let a,i;const n="start_date"in o[0]?"start_date":"date",r="start_date"in o[0]?"end_date":"date";o.forEach(t=>{(!a||t[r]>a)&&(a=t[r]),(!i||t[n]<i)&&(i=t[n])});const s=new Pikaday({field:document.getElementById("current_date"),position:"top right",minDate:string_to_date(i),maxDate:string_to_date(a),onSelect:function(t){t instanceof Date&&(t=date_to_string(t));const e=o.filter(e=>e.start_date<=t&&(e.end_date>=t||!e.end_date));avoid_collision.reset&&avoid_collision.reset(),update_routes(e),$("#current_count").text(`(${e.length})`)}});s.setDate(string_to_date("2020-01-01")),$("#previous_date").click(()=>{const t=s.getDate();t.setDate(t.getDate()-1),date_to_string(t)>=i&&s.setDate(t)}),$("#next_date").click(()=>{const t=s.getDate();t.setDate(t.getDate()+1),date_to_string(t)<=a&&s.setDate(t)})}function update_routes(t){const e=d3.select("#routes").selectAll("circle.route").data(t,t=>t.id);e.enter().append("circle").attr("class","route").attr("opacity",1).attr("fill",t=>get_color(t.route_color)).attr("fill-opacity",0).attr("stroke",t=>get_color(t.route_color)).attr("stroke-width","1px").attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",5).on("mouseover",t=>hover(t,avoid_collision(t))).on("mouseout",(t,e,o)=>{d3.select("#info_div").transition().delay(200).duration(100).style("opacity",0)}).on("click",t=>window.open("https://www.vertical-life.info/en/indoor/the-cliffs-at-lic/climbs/"+t.route_id,"_blank")).transition().duration(1e3).attr("r",5).attr("cx",t=>avoid_collision(t).x).attr("cy",t=>avoid_collision(t).y),e.transition().duration(1e3).attr("r",5).attr("cx",t=>avoid_collision(t).x).attr("cy",t=>avoid_collision(t).y),e.exit().transition().duration(1e3).attr("r",20).attr("opacity",0).remove()}$(document).ready(async()=>{const t=d3.select("#svg_container"),e=await load_svg(t),o=await d3.csv("data/routes.csv");o.forEach((t,e)=>{const o=d3.select("#"+t.wall).node().getPointAtLength(t.offset);t.x=o.x,t.y=o.y,t.offset=parseFloat(t.offset),t.id=e}),init(t,e,o)});
