function load_svg(e,t="img/cliffsmap.svg"){function o(e,t,o){return function(e){const t=o[0].getTotalLength();return d3.interpolateString("0,"+t,t+","+t)(e)}}return d3.xml("img/cliffsmap.svg").then(async t=>{const r=d3.select(e.node().appendChild(t.documentElement)),l=r.selectAll("g#pads-layer,g#roof-layer,g#structures-layer").style("opacity",0);return r.selectAll("g#walls-layer > path").each((e,t,r)=>{d3.select(r[t]).transition().duration(3e3).attrTween("stroke-dasharray",o)}),await l.transition().delay(3e3).duration(1e3).style("opacity",1).end(),r})}function get_color(e){const t={Red:"#ff0000",Blue:"#0000ff",Green:"#00ff00",Grey:"#888888",Gray:"#888888","Lime Green":"#00d221",White:"#ffffff",Black:"#000000",Purple:"#6d00c1",Pink:"#ffa0e9",Yellow:"#fcdc00",Tan:"#eacca5",Orange:"#ff9000"};for(;!t[e];){let t;if(!(t=e.match(/^(.*) [^ ]+$/)))break;e=t[1]}try{return t[e]}catch(t){return console.log("No color for "+e),console.log(t),"#000000"}}function contrast_color(e,t){return"white"!=e&&"#ffffff"!=e||"#ffffff"!=t&&"white"!=t?e:"#eeeeee"}function avoid_collision(e){const t=avoid_collision;if(t.reset||(t.reset=()=>t.cache={by_wall:{},by_event:{}}),t.cache||(t.cache={by_wall:{},by_event:{}}),t.cache.by_event[e.id])return t.cache.by_event[e.id];const o={"Bouldering 3D":6,"*":8},r=o[e.category]||o["*"],l=t.cache.by_wall,n=t.cache.by_event,c=d3.select("#"+e.wall).node(),a=c.getTotalLength(),i=Math.round(e.offset/r)*r;l[e.wall]||(l[e.wall]={});const f=l[e.wall];if(!f[i])return f[i]=!0,n[e.id]={x:e.x,y:e.y},n[e.id];for(let t=2;;++t){const o=Math.trunc(t/2)*(t%2==0?1:-1)*r,l=i+o,s=e.offset+o;if(!f[l]&&s>=0&&s<=a)return f[l]=!0,n[e.id]=c.getPointAtLength(s),n[e.id];if(t>100)return console.log("Couldn't avoid a collision with data:"),console.log(e),{}}}function hover(e,t){const o=$("#info_div"),r=$("#svg_container svg"),l=r.get(0).getBoundingClientRect(),n=r.get(0).getScreenCTM(),c=["x","y","offset","route_id","id","wall","start_date","end_date"];let a=n.a*t.x+n.c*t.y+n.e-l.x,i=n.b*t.x+n.d*t.y+n.f-l.y,f="";Object.keys(e).forEach(t=>{if(c.includes(t)||""==e[t])return;let o=e[t];if("route_color"==t&&(bg_color=get_color(e.route_color),border_color=contrast_color(get_color(e.route_color),"white"),style=`border-color:${border_color};background-color:${bg_color}`,o=`<div class='swatch_color' style='${style}'></div> ${o}`),"rating"==t){if(!o)return;o+=" / 5"}f+=`<div>${t}: ${o}</div>\n`}),o.html(f),t.x>r.outerWidth()/2&&(a-=o.outerWidth(!0)),t.y>r.outerHeight()/2&&(i-=o.outerHeight(!0)),d3.select("#info_div").transition().duration(100).style("opacity",1).style("border-color",contrast_color(get_color(e.route_color),"white")).style("left",a+"px").style("top",i+"px")}
